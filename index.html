<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Task Taxonomy Tool for Higher Education (Multi-Step)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
     <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        /* Apply Inter font globally */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Page container */
        .page { display: none; /* Hidden by default */ }
        .page.active { display: block; /* Show active page */ }

        /* Style for details summary */
        summary { cursor: pointer; font-weight: 500; color: #3b82f6; margin-bottom: 0.5rem; display: inline-block; }
        summary:hover { color: #2563eb; }
        summary::marker { content: '▶ '; font-size: 0.8em; }
        details[open] summary::marker { content: '▼ '; }

        /* Style for the result box */
        #resultBox { border-left-width: 4px; padding: 1.5rem; margin-top: 1.5rem; border-radius: 0.375rem; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .result-human-led { border-color: #ef4444; background-color: #fee2e2; } /* Red */
        .result-ai-assisted { border-color: #f97316; background-color: #ffedd5; } /* Orange */
        .result-high-automation { border-color: #84cc16; background-color: #ecfccb; } /* Lime */
        .result-full-automation { border-color: #22c55e; background-color: #dcfce7; } /* Green */
        .result-default { border-color: #6b7280; background-color: #f3f4f6; } /* Gray */

        /* Textarea size */
        textarea { min-height: 70px; }

        /* Diagram styling */
        .diagram-box { border: 1px solid #cbd5e1; padding: 0.75rem 1rem; border-radius: 0.375rem; text-align: center; font-size: 0.875rem; background-color: #f8fafc; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); min-height: 60px; display: flex; align-items: center; justify-content: center; }
        .diagram-arrow { font-size: 1.5rem; color: #9ca3af; display: flex; align-items: center; justify-content: center; margin: 0 0.5rem; }

        /* Fieldset styling */
        .fieldset-legend { font-size: 1.125rem; font-weight: 600; color: #1f2937; padding: 0 0.5rem; margin-bottom: 0.25rem; }
        /* Updated Dimension Description Style */
        .dimension-description {
            font-size: 0.95rem; /* Increased size */
            font-weight: 600; /* Bold */
            color: #374151; /* Slightly darker gray */
            margin-bottom: 1.5rem; /* Increased bottom margin */
            padding: 0 0.5rem;
            line-height: 1.5; /* Improved line spacing */
        }
        fieldset { background-color: #ffffff; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); margin-bottom: 2rem; } /* Add margin bottom to fieldsets on eval pages */

        /* Focus states */
        input:focus, select:focus, textarea:focus { border-color: #2563eb; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); outline: none; }

        /* Button styling */
         .action-button { padding: 0.75rem 1.75rem; font-size: 1rem; font-weight: 600; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); transition: all 0.2s ease-in-out; cursor: pointer; display: inline-block; text-align: center; }
         .submit-button { background-color: #2563eb; color: white; hover:bg-blue-700; focus:ring-2 focus:ring-offset-2 focus:ring-blue-500; }
         .export-button { background-color: #16a34a; color: white; hover:bg-green-700; focus:ring-2 focus:ring-offset-2 focus:ring-green-500; margin-left: 1rem; }
         .nav-button { background-color: #4f46e5; color: white; hover:bg-indigo-700; focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500; }
         .back-button { background-color: #6b7280; color: white; hover:bg-gray-700; focus:ring-2 focus:ring-offset-2 focus:ring-gray-500; margin-right: 1rem; }
         .page-navigation { margin-top: 2rem; display: flex; justify-content: space-between; align-items: center; } /* Container for Prev/Next buttons */

        /* Question Styling */
        .question-item { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; }
        .question-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .question-label { display: block; font-weight: 600; color: #1f2937; margin-bottom: 0.25rem; text-sm; } /* Semibold label */
        .question-description { font-size: 0.8rem; color: #6b7280; margin-bottom: 0.75rem; } /* Smaller description text */
        .scale-container { display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem; align-items: center; }
        .scale-container label { margin-right: 0.5rem; font-size: 0.875rem; color: #374151; cursor: pointer; }
        .scale-container input[type="radio"], .scale-container input[type="number"], .scale-container input[type="checkbox"] { margin-right: 0.25rem; cursor: pointer; }
        input[type="number"] { width: 70px; padding: 0.3rem 0.5rem; }

        /* Stakeholder styling */
        .stakeholder-group label { display: flex; align-items: center; margin-bottom: 0.5rem; }
        #otherStakeholderInput { margin-top: 0.5rem; }

        /* Dimension Score Display */
        .dimension-score-display { margin-top: 1rem; padding: 0.5rem 1rem; background-color: #eef2ff; border: 1px solid #c7d2fe; border-radius: 0.375rem; text-align: center; font-weight: 500; color: #4338ca; }
        .dimension-score-display .score-value { font-weight: 700; margin-left: 0.5rem; }

        /* Stakeholder Prompts Area */
        #stakeholderPrompts { font-size: 0.875rem; color: #1d4ed8; background-color: #eff6ff; border-left: 3px solid #3b82f6; padding: 0.75rem; margin-top: 1rem; border-radius: 0.25rem; }
        #stakeholderPrompts ul { list-style-type: disc; margin-left: 1.5rem; }

        /* Progress Indicator */
        .progress-indicator { text-align: center; margin-bottom: 1.5rem; font-size: 0.9rem; color: #4b5563; font-weight: 500; }

        /* Chart Container Style */
        #radarChartContainer { max-width: 500px; margin: 2rem auto; padding: 1rem; background-color: #ffffff; border: 1px solid #e5e7eb; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }


         /* PDF Export Styles */
         #pdfContent { font-family: sans-serif; padding: 20px; color: #333; }
         #pdfContent h1 { font-size: 18pt; margin-bottom: 15px; color: #111; }
         #pdfContent h2 { font-size: 14pt; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; color: #222; }
         #pdfContent h3 { font-size: 12pt; margin-top: 15px; margin-bottom: 5px; color: #444; }
         /* Updated PDF description style */
         #pdfContent .dimension-desc-pdf { font-size: 10pt; font-weight: bold; color: #333; margin-bottom: 12px; }
         #pdfContent p { font-size: 10pt; line-height: 1.4; margin-bottom: 8px; }
         #pdfContent .label { font-weight: bold; }
         #pdfContent .notes { font-style: italic; color: #555; margin-left: 15px; font-size: 9pt; }
         #pdfContent .result-section { margin-top: 25px; padding: 15px; border: 1px solid #ddd; background-color: #f9f9f9; }
         #pdfContent .result-category { font-size: 14pt; font-weight: bold; margin-bottom: 10px; }
         #pdfContent .result-rationale { font-size: 10pt; }
         #pdfContent .result-disclaimer { font-size: 8pt; color: #777; margin-top: 15px; }
         #pdfContent .question-block { margin-bottom: 10px; page-break-inside: avoid; } /* Avoid breaking questions in PDF */
         #pdfContent .question-text { font-weight: bold; font-size: 10pt; margin-bottom: 2px;}
         #pdfContent .question-desc-pdf { font-size: 8.5pt; color: #666; margin-bottom: 4px; } /* Style for sub-item desc in PDF */
         #pdfContent .question-answer { margin-left: 10px; font-size: 10pt; }
         #pdfContent .dimension-score-pdf { font-weight: bold; font-size: 11pt; margin-top: 5px; color: #0056b3; }
         #pdfContent .stakeholder-list-pdf { margin-top: 5px; font-size: 10pt; }
         #pdfContent .chart-container-pdf { width: 100%; max-width: 400px; margin: 20px auto; } /* Style for chart in PDF */

         /* Style to temporarily make PDF content renderable but off-screen */
         .pdf-render-area {
            position: fixed !important;
            inset: 0 !important;          /* full viewport */
            background: #ffffff;
            opacity: 0;                   /* invisible to the user */
            z-index: -1;                  /* behind everything */
         }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-lg">

        <div id="landingPage" class="page active">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 text-center">AI Task Taxonomy Evaluation Framework</h1>
            <p class="text-gray-600 mb-8 text-center text-lg leading-relaxed">
                Welcome! This framework helps Higher Education staff evaluate tasks for potential AI integration.
                It considers the task's nature, risks, ethics, stakeholder value, human element, and feasibility
                to suggest an appropriate level of AI involvement.
            </p>

            <div class="mb-10 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">Framework Overview</h2>
                <div class="flex flex-col md:flex-row items-center justify-center space-y-2 md:space-y-0 md:space-x-4 mb-4">
                     <div class="diagram-box bg-blue-100 border-blue-300 text-blue-800">Input:<br>Specific HEI Task</div>
                     <div class="diagram-arrow hidden md:block">→</div>
                     <div class="diagram-box bg-yellow-100 border-yellow-300 text-yellow-800">Evaluation:<br>6 Dimensions (Scored)</div>
                     <div class="diagram-arrow hidden md:block">→</div>
                     <div class="diagram-box bg-green-100 border-green-300 text-green-800">Output:<br>4 Categories</div>
                </div>
                 <p class="text-center text-gray-600 mt-4">
                    The evaluation across the six dimensions leads to a suggested category: Human-Led, AI-Assisted, High Automation Potential, or Full Automation.
                </p>
            </div>

             <div class="mb-10 p-4 border border-gray-200 rounded-lg bg-gray-50">
                 <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">The Six Dimensions</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm text-gray-700">
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>1. Task Nature & Complexity:</strong> Characteristics like repetitiveness, cognitive load, data needs, and creativity requirements.</div>
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>2. Risk, Safety & Security:</strong> Potential harms like data breaches, bias, safety issues, and integrity concerns.</div>
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>3. Ethical Considerations:</strong> Alignment with fairness, transparency, accountability, and human dignity.</div>
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>4. Stakeholder Value & Impact:</strong> Potential benefits or drawbacks for students, staff, and the institution.</div>
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>5. Human Element Requirement:</strong> Need for empathy, mentorship, nuanced judgment, or complex communication.</div>
                     <div class="p-3 bg-white rounded border border-gray-200"><strong>6. Feasibility & Implementation:</strong> Practical aspects like tech maturity, data, cost, skills, and policy.</div>
                 </div>
             </div>

             <!-- Output-category explanations -->
<div class="mb-10 p-4 border border-gray-200 rounded-lg bg-gray-50">
    <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">
      What the Four Suggested Categories Mean
    </h2>
  
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
      <div class="p-3 bg-white rounded border border-gray-200">
        <strong>Human-Led (No / Minimal AI)</strong><br>
        High-risk, ethically sensitive or empathy-heavy tasks.  
        AI may provide very limited support, but humans stay fully responsible.
      </div>
  
      <div class="p-3 bg-white rounded border border-gray-200">
        <strong>AI-Assisted (Human in Control)</strong><br>
        AI speeds up or augments parts of the work, yet humans still steer
        decisions and remain accountable throughout.
      </div>
  
      <div class="p-3 bg-white rounded border border-gray-200">
        <strong>High Automation Potential (Human Supervising)</strong><br>
        Most steps can run automatically, but routine human oversight is
        advisable for edge cases, quality assurance and accountability.
      </div>
  
      <div class="p-3 bg-white rounded border border-gray-200">
        <strong>Full Automation (Minimal Oversight Post-Setup)</strong><br>
        Well-defined, low-risk and repeatable tasks suitable for end-to-end
        automation once properly configured and periodically monitored.
      </div>
    </div>
  </div>

  
            <div class="text-center mt-8">
                <button data-target-page="taskIdentificationPage" class="action-button nav-button text-lg px-10 py-3 navigate-button">
                    Start Task Identification →
                </button>
            </div>
        </div>

        <div id="taskIdentificationPage" class="page" data-page-index="1">
             <div class="progress-indicator">Step 1 of 9: Task Identification</div>
             <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 text-center">Task Identification</h1>
             <p class="text-gray-600 mb-8 text-center">Define the task you want to evaluate and identify the key stakeholders involved.</p>

             <form id="taskIdentificationForm" class="space-y-8">
                 <fieldset class="border border-gray-300 p-5 rounded-md">
                     <legend class="fieldset-legend">Task Details</legend>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-2">
                         <div>
                             <label for="taskName" class="block text-sm font-medium text-gray-700 mb-1">Task Name:</label>
                             <input type="text" id="taskName" name="taskName" required placeholder="e.g., Grading MCQs for Intro Course" class="w-full p-2.5 border border-gray-300 rounded-md shadow-sm">
                        </div>
                         <div>
                             <label for="evaluator" class="block text-sm font-medium text-gray-700 mb-1">Evaluator(s):</label>
                             <input type="text" id="evaluator" name="evaluator" placeholder="e.g., John Doe, Curriculum Committee" class="w-full p-2.5 border border-gray-300 rounded-md shadow-sm">
                        </div>
                         <div>
                             <label for="evalDate" class="block text-sm font-medium text-gray-700 mb-1">Date:</label>
                             <input type="date" id="evalDate" name="evalDate" required class="w-full p-2.5 border border-gray-300 rounded-md shadow-sm">
                        </div>
                         <div class="md:col-span-2">
                             <label class="block text-sm font-medium text-gray-700 mb-2">Key Stakeholder Groups Involved:</label>
                             <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-2 stakeholder-group">
                                 <label><input type="checkbox" name="stakeholder" value="Students" class="mr-2"> Students</label>
                                 <label><input type="checkbox" name="stakeholder" value="Faculty" class="mr-2"> Faculty / Instructors</label>
                                 <label><input type="checkbox" name="stakeholder" value="Admin Staff" class="mr-2"> Administrative Staff</label>
                                 <label><input type="checkbox" name="stakeholder" value="IT Staff" class="mr-2"> IT Staff</label>
                                 <label><input type="checkbox" name="stakeholder" value="Researchers" class="mr-2"> Researchers</label>
                                 <label>
                                     <input type="checkbox" id="stakeholderOtherCheck" name="stakeholder" value="Other" class="mr-2"> Other
                                 </label>
                             </div>
                             <input type="text" id="otherStakeholderInput" name="otherStakeholderText" placeholder="Specify other stakeholders" class="w-full p-2.5 border border-gray-300 rounded-md shadow-sm mt-2 hidden">
                         </div>
                     </div>
                 </fieldset>

                 <div class="page-navigation">
                      <button type="button" data-target-page="landingPage" class="action-button back-button navigate-button">
                         ← Back to Description
                     </button>
                     <button type="button" data-target-page="evaluationPage_Nature" id="goToEvaluationButton" class="action-button nav-button navigate-button">
                         Proceed to Dimension 1 →
                     </button>
                 </div>
             </form>
        </div>

        <div id="evaluationPage_Nature" class="page" data-page-index="2">
            <div class="progress-indicator">Step 2 of 9: Dimension 1 - Task Nature & Complexity</div>
            <form class="dimension-form space-y-8">
                <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="nature">
                    <legend class="fieldset-legend">1. Task Nature & Complexity</legend>
                    <p class="dimension-description">The inherent characteristics of the task itself, such as how repetitive, data-driven, or creative it is. This helps determine its baseline suitability for automation.</p>
                    <div class="question-item">
                        <span class="question-label">Repetitiveness</span>
                        <p class="question-description">How routine and predictable is the task? Highly repetitive tasks follow the same steps each time, while variable tasks require different approaches.</p>
                        <div class="scale-container"> <label><input type="radio" name="nature_repetitiveness" value="1" required> Highly Variable</label> <label><input type="radio" name="nature_repetitiveness" value="2"> Somewhat Variable</label> <label><input type="radio" name="nature_repetitiveness" value="3"> Mixed</label> <label><input type="radio" name="nature_repetitiveness" value="4"> Somewhat Repetitive</label> <label><input type="radio" name="nature_repetitiveness" value="5"> Highly Repetitive</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Cognitive Load</span>
                        <p class="question-description">What kind of thinking is required? Simple rule-following, data analysis/interpretation, or complex judgment and creative problem-solving?</p>
                        <div class="scale-container"> <label><input type="radio" name="nature_cognitive" value="1" required> Judgment/Creative</label> <label><input type="radio" name="nature_cognitive" value="3"> Analytical</label> <label><input type="radio" name="nature_cognitive" value="5"> Rule-Following</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Data Dependence</span>
                        <p class="question-description">How much does the task rely on processing data? Consider the volume and type (structured like spreadsheets vs. unstructured like text/images).</p>
                        <div class="scale-container"> <label><input type="radio" name="nature_data" value="1" required> Low/Qualitative</label> <label><input type="radio" name="nature_data" value="3"> Moderate/Mixed</label> <label><input type="radio" name="nature_data" value="5"> High/Structured</label> </div>
                    </div>
                     <div class="question-item">
                        <span class="question-label">Determinism vs. Ambiguity</span>
                        <p class="question-description">How clear and unambiguous are the task inputs, processes, and desired outputs? Deterministic tasks have clear rules, while ambiguous ones require interpretation.</p>
                        <div class="scale-container"> <label><input type="radio" name="nature_ambiguity" value="1" required> Highly Ambiguous</label> <label><input type="radio" name="nature_ambiguity" value="2"> Somewhat Ambiguous</label> <label><input type="radio" name="nature_ambiguity" value="3"> Mixed</label> <label><input type="radio" name="nature_ambiguity" value="4"> Somewhat Deterministic</label> <label><input type="radio" name="nature_ambiguity" value="5"> Highly Deterministic</label> </div>
                    </div>
                    <div class="mt-4"> <label for="notesNature" class="block text-sm font-medium text-gray-700 mb-1">Notes/Rationale:</label> <textarea id="notesNature" name="notesNature" rows="2" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Avg): <span class="score-value" id="score_nature">N/A</span> </div>
                </fieldset>
                 <div class="page-navigation">
                      <button type="button" data-target-page="taskIdentificationPage" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="button" data-target-page="evaluationPage_Risk" class="action-button nav-button navigate-button">
                         Next →
                     </button>
                 </div>
            </form>
        </div>

        <div id="evaluationPage_Risk" class="page" data-page-index="3">
            <div class="progress-indicator">Step 3 of 9: Dimension 2 - Risk, Safety & Security</div>
             <form class="dimension-form space-y-8">
                <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="risk">
                    <legend class="fieldset-legend">2. Risk, Safety & Security</legend>
                    <p class="dimension-description">Potential negative consequences of using AI for this task, including data breaches, bias, safety issues, and damage to integrity or reputation. Higher scores indicate greater risk.</p>
                    <div class="question-item">
                        <span class="question-label">Data Privacy & Security Risk</span>
                        <p class="question-description">How likely and severe is the potential harm if sensitive data (student, staff, research) involved in this task is breached or misused by the AI?</p>
                        <div class="scale-container"> <label><input type="radio" name="risk_privacy" value="1" required> Low</label> <label><input type="radio" name="risk_privacy" value="3"> Medium</label> <label><input type="radio" name="risk_privacy" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Algorithmic Bias & Fairness Risk</span>
                         <p class="question-description">How likely is the AI to introduce, perpetuate, or amplify unfair bias against specific groups in its process or outcomes?</p>
                        <div class="scale-container"> <label><input type="radio" name="risk_bias" value="1" required> Low</label> <label><input type="radio" name="risk_bias" value="3"> Medium</label> <label><input type="radio" name="risk_bias" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Safety & Well-being Risk</span>
                        <p class="question-description">Could AI errors or misuse in this task lead to direct or indirect physical harm, psychological distress, or negative impacts on well-being?</p>
                        <div class="scale-container"> <label><input type="radio" name="risk_safety" value="1" required> Low</label> <label><input type="radio" name="risk_safety" value="3"> Medium</label> <label><input type="radio" name="risk_safety" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Operational & Reputational Risk</span>
                        <p class="question-description">How significant is the potential disruption to operations or damage to the institution's reputation if the AI fails, gives wrong results, or is misused?</p>
                        <div class="scale-container"> <label><input type="radio" name="risk_operational" value="1" required> Low</label> <label><input type="radio" name="risk_operational" value="3"> Medium</label> <label><input type="radio" name="risk_operational" value="5" required> High</label> </div>
                    </div>
                    <div class="mt-4"> <label for="notesRisk" class="block text-sm font-medium text-gray-700 mb-1">Key Risks & Mitigation Notes:</label> <textarea id="notesRisk" name="notesRisk" rows="2" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Max): <span class="score-value" id="score_risk">N/A</span> </div>
                </fieldset>
                 <div class="page-navigation">
                      <button type="button" data-target-page="evaluationPage_Nature" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="button" data-target-page="evaluationPage_Ethics" class="action-button nav-button navigate-button">
                         Next →
                     </button>
                 </div>
             </form>
        </div>

        <div id="evaluationPage_Ethics" class="page" data-page-index="4">
            <div class="progress-indicator">Step 4 of 9: Dimension 3 - Ethical Considerations</div>
             <form class="dimension-form space-y-8">
                <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="ethics">
                    <legend class="fieldset-legend">3. Ethical Considerations</legend>
                    <p class="dimension-description">Alignment with ethical principles like fairness, transparency, accountability, and respect for human autonomy. Higher scores indicate greater ethical concern.</p>
                    <div class="question-item">
                        <span class="question-label">Fairness & Equity Concern</span>
                        <p class="question-description">Does the potential use of AI raise concerns about equitable treatment, access, or outcomes for all individuals or groups affected by the task?</p>
                        <div class="scale-container"> <label><input type="radio" name="ethics_fairness" value="1" required> Low</label> <label><input type="radio" name="ethics_fairness" value="3"> Medium</label> <label><input type="radio" name="ethics_fairness" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Transparency & Explainability Concern</span>
                         <p class="question-description">How difficult would it be to understand and explain how the AI reaches its decisions or outputs, especially for high-stakes tasks?</p>
                        <div class="scale-container"> <label><input type="radio" name="ethics_transparency" value="1" required> Low</label> <label><input type="radio" name="ethics_transparency" value="3"> Medium</label> <label><input type="radio" name="ethics_transparency" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Accountability & Responsibility Concern</span>
                        <p class="question-description">How clear is it who would be responsible if the AI makes an error, causes harm, or operates unethically? Is there a clear line of accountability?</p>
                        <div class="scale-container"> <label><input type="radio" name="ethics_accountability" value="1" required> Low</label> <label><input type="radio" name="ethics_accountability" value="3"> Medium</label> <label><input type="radio" name="ethics_accountability" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Human Dignity & Autonomy Concern</span>
                        <p class="question-description">Does the AI's potential role respect human agency, avoid undue influence or deception, and prevent over-reliance that undermines human skills or judgment?</p>
                        <div class="scale-container"> <label><input type="radio" name="ethics_dignity" value="1" required> Low</label> <label><input type="radio" name="ethics_dignity" value="3"> Medium</label> <label><input type="radio" name="ethics_dignity" value="5" required> High</label> </div>
                    </div>
                    <div class="mt-4"> <label for="notesEthics" class="block text-sm font-medium text-gray-700 mb-1">Key Ethical Issues & Safeguard Notes:</label> <textarea id="notesEthics" name="notesEthics" rows="2" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Max): <span class="score-value" id="score_ethics">N/A</span> </div>
                </fieldset>
                 <div class="page-navigation">
                      <button type="button" data-target-page="evaluationPage_Risk" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="button" data-target-page="evaluationPage_Value" class="action-button nav-button navigate-button">
                         Next →
                     </button>
                 </div>
             </form>
        </div>

        <div id="evaluationPage_Value" class="page" data-page-index="5">
            <div class="progress-indicator">Step 5 of 9: Dimension 4 - Stakeholder Value & Impact</div>
             <form class="dimension-form space-y-8">
                <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="value">
                    <legend class="fieldset-legend">4. Stakeholder Value & Impact</legend>
                    <p class="dimension-description">The potential benefits and positive effects of using AI on key groups (students, staff, institution). Higher scores indicate greater potential value.</p>
                    <div class="question-item">
                        <span class="question-label">Value for Students</span>
                        <p class="question-description">How significantly could AI enhance student learning outcomes, engagement, access to resources, support services, or overall educational experience?</p>
                        <div class="scale-container"> <label><input type="radio" name="value_student" value="1" required> Low</label> <label><input type="radio" name="value_student" value="3"> Medium</label> <label><input type="radio" name="value_student" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Value for Staff (Faculty/Admin/Etc.)</span>
                        <p class="question-description">How significantly could AI reduce tedious workload, free up time for higher-value activities (mentoring, research), or enhance staff capabilities and job satisfaction?</p>
                        <div class="scale-container"> <label><input type="radio" name="value_staff" value="1" required> Low</label> <label><input type="radio" name="value_staff" value="3"> Medium</label> <label><input type="radio" name="value_staff" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Value for Institution</span>
                        <p class="question-description">How significantly could AI improve operational efficiency, reduce costs, enhance decision-making, boost research output, or advance strategic goals?</p>
                        <div class="scale-container"> <label><input type="radio" name="value_institution" value="1" required> Low</label> <label><input type="radio" name="value_institution" value="3"> Medium</label> <label><input type="radio" name="value_institution" value="5" required> High</label> </div>
                    </div>
                     <div class="question-item">
                        <span class="question-label">Alignment with Mission/Strategic Goals</span>
                        <p class="question-description">How well does using AI for this task align with the institution's core mission, values, and long-term strategic objectives?</p>
                        <div class="scale-container"> <label><input type="radio" name="value_alignment" value="1" required> Poor Alignment</label> <label><input type="radio" name="value_alignment" value="3"> Neutral/Moderate</label> <label><input type="radio" name="value_alignment" value="5" required> Strong Alignment</label> </div>
                    </div>
                    <div id="stakeholderPrompts" class="hidden"></div>
                    <div class="mt-4"> <label id="notesValueLabel" for="notesValue" class="block text-sm font-medium text-gray-700 mb-1">Key Impacts (Positive/Negative) & Stakeholder Notes:</label> <textarea id="notesValue" name="notesValue" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Avg): <span class="score-value" id="score_value">N/A</span> </div>
                </fieldset>
                 <div class="page-navigation">
                      <button type="button" data-target-page="evaluationPage_Ethics" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="button" data-target-page="evaluationPage_Human" class="action-button nav-button navigate-button">
                         Next →
                     </button>
                 </div>
             </form>
        </div>

         <div id="evaluationPage_Human" class="page" data-page-index="6">
             <div class="progress-indicator">Step 6 of 9: Dimension 5 - Human Element Requirement</div>
             <form class="dimension-form space-y-8">
                 <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="human">
                    <legend class="fieldset-legend">5. Human Element Requirement</legend>
                    <p class="dimension-description">The degree to which inherently human skills like empathy, nuanced judgment, mentorship, and complex communication are essential for the task's success. Higher scores indicate greater need for human involvement.</p>
                    <div class="question-item">
                        <span class="question-label">Need for Empathy & Interpersonal Skills</span>
                        <p class="question-description">How crucial are understanding emotions, showing compassion, and navigating complex interpersonal dynamics for this task?</p>
                        <div class="scale-container"> <label><input type="radio" name="human_empathy" value="1" required> Minimal</label> <label><input type="radio" name="human_empathy" value="2"> Beneficial</label> <label><input type="radio" name="human_empathy" value="3"> Important</label> <label><input type="radio" name="human_empathy" value="4" required> Essential</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Need for Mentorship & Guidance</span>
                        <p class="question-description">Does the task involve personalized coaching, fostering critical thinking, inspiring others, or providing tailored developmental support?</p>
                        <div class="scale-container"> <label><input type="radio" name="human_mentorship" value="1" required> Minimal</label> <label><input type="radio" name="human_mentorship" value="2"> Beneficial</label> <label><input type="radio" name="human_mentorship" value="3"> Important</label> <label><input type="radio" name="human_mentorship" value="4" required> Essential</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Need for Nuanced Judgment & Contextual Understanding</span>
                        <p class="question-description">How much does the task require interpreting subtle cues, understanding complex situations, making subjective judgments, or adapting to unique contexts?</p>
                        <div class="scale-container"> <label><input type="radio" name="human_judgment" value="1" required> Minimal</label> <label><input type="radio" name="human_judgment" value="2"> Beneficial</label> <label><input type="radio" name="human_judgment" value="3"> Important</label> <label><input type="radio" name="human_judgment" value="4" required> Essential</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Need for High-Stakes or Sensitive Communication</span>
                         <p class="question-description">Does the task involve delivering difficult news, handling conflicts, engaging in persuasive dialogue, or building trust through communication?</p>
                        <div class="scale-container"> <label><input type="radio" name="human_communication" value="1" required> Minimal</label> <label><input type="radio" name="human_communication" value="2"> Beneficial</label> <label><input type="radio" name="human_communication" value="3"> Important</label> <label><input type="radio" name="human_communication" value="4" required> Essential</label> </div>
                    </div>
                    <div class="mt-4"> <label for="notesHuman" class="block text-sm font-medium text-gray-700 mb-1">Notes/Rationale:</label> <textarea id="notesHuman" name="notesHuman" rows="2" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Max): <span class="score-value" id="score_human">N/A</span> </div>
                </fieldset>
                 <div class="page-navigation">
                      <button type="button" data-target-page="evaluationPage_Value" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="button" data-target-page="evaluationPage_Feasibility" class="action-button nav-button navigate-button">
                         Next →
                     </button>
                 </div>
             </form>
        </div>

         <div id="evaluationPage_Feasibility" class="page" data-page-index="7">
            <div class="progress-indicator">Step 7 of 9: Dimension 6 - Feasibility & Implementation</div>
             <form id="evaluationForm" class="dimension-form space-y-8"> <fieldset class="border border-gray-300 p-5 rounded-md flex flex-col" data-dimension="feasibility">
                    <legend class="fieldset-legend">6. Feasibility & Implementation</legend>
                    <p class="dimension-description">The practical and logistical aspects of implementing AI for this task, including technology readiness, data availability, cost, required skills, and policy alignment. Higher scores indicate greater feasibility.</p>
                    <div class="question-item">
                        <span class="question-label">Technology Maturity & Reliability</span>
                        <p class="question-description">How proven, stable, and reliable is the required AI technology for this specific application context?</p>
                        <div class="scale-container"> <label><input type="radio" name="feasibility_tech" value="1" required> Low</label> <label><input type="radio" name="feasibility_tech" value="3"> Medium</label> <label><input type="radio" name="feasibility_tech" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Data Availability, Quality & Appropriateness</span>
                        <p class="question-description">Is sufficient, high-quality, relevant, and appropriately unbiased data readily available to train and operate the AI effectively?</p>
                        <div class="scale-container"> <label><input type="radio" name="feasibility_data" value="1" required> Low</label> <label><input type="radio" name="feasibility_data" value="3"> Medium</label> <label><input type="radio" name="feasibility_data" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Cost-Effectiveness & Resource Availability</span>
                        <p class="question-description">Are the expected benefits (efficiency, cost savings, etc.) likely to justify the financial, personnel, and infrastructure costs of implementation and maintenance?</p>
                        <div class="scale-container"> <label><input type="radio" name="feasibility_cost" value="1" required> Low</label> <label><input type="radio" name="feasibility_cost" value="3"> Medium</label> <label><input type="radio" name="feasibility_cost" value="5" required> High</label> </div>
                    </div>
                    <div class="question-item">
                        <span class="question-label">Integration & Policy Alignment</span>
                        <p class="question-description">How easily can the AI be integrated with existing systems? Does it align with current institutional policies, regulations, and governance structures?</p>
                        <div class="scale-container"> <label><input type="radio" name="feasibility_integration" value="1" required> Low</label> <label><input type="radio" name="feasibility_integration" value="3"> Medium</label> <label><input type="radio" name="feasibility_integration" value="5" required> High</label> </div>
                    </div>
                    <div class="mt-4"> <label for="notesFeasibility" class="block text-sm font-medium text-gray-700 mb-1">Key Barriers & Resource Notes:</label> <textarea id="notesFeasibility" name="notesFeasibility" rows="2" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></textarea> </div>
                    <div class="dimension-score-display mt-auto"> Dimension Score (Avg): <span class="score-value" id="score_feasibility">N/A</span> </div>
                </fieldset>

                 <div class="page-navigation">
                      <button type="button" data-target-page="evaluationPage_Human" class="action-button back-button navigate-button">
                         ← Back
                     </button>
                     <button type="submit" class="action-button submit-button">
                         Calculate & View Results →
                     </button>
                 </div>
            </form>
        </div> <div id="resultsPage" class="page" data-page-index="8">
            <div class="progress-indicator">Step 8 of 9: Evaluation Result</div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 text-center">Evaluation Result</h1>

            <div id="resultArea" class="mt-6"> <div id="resultBox" class="result-default max-w-3xl mx-auto">
                     <p id="resultCategory" class="font-bold text-lg mb-2">Suggested Category: [Calculating...]</p>
                     <p id="resultRationale" class="text-gray-700 text-base">Rationale: [Calculating...]</p>
                     <p id="resultDisclaimer" class="text-sm text-gray-600 mt-4 italic"></p>
                 </div>

                 <!-- Radar Chart Container -->
                 <div id="radarChartContainer">
                     <canvas id="myRadarChart"></canvas>
                 </div>

            </div>
             <div class="page-navigation">
                  <button type="button" data-target-page="evaluationPage_Feasibility" class="action-button back-button navigate-button">
                     ← Back to Feasibility
                 </button>
                 <div> <button type="button" id="exportPdfButton" class="action-button export-button">
                         Export Results to PDF
                     </button>
                     <button type="button" data-target-page="landingPage" class="action-button back-button navigate-button ml-4">
                        ← Start New Evaluation
                    </button>
                 </div>
             </div>
        </div> <div id="pdfContent" class="hidden"></div>

    </div> <script>
        // --- Initialization ---
        const landingPage = document.getElementById('landingPage');
        const taskIdentificationPage = document.getElementById('taskIdentificationPage');
        const resultsPage = document.getElementById('resultsPage'); // Added results page
        // Get all dimension pages
        const dimensionPages = document.querySelectorAll('.page[data-page-index]'); // Select dimension pages specifically

        const taskIdentificationForm = document.getElementById('taskIdentificationForm');
        const evaluationForm = document.getElementById('evaluationForm'); // Form on the last page for submission

        const resultArea = document.getElementById('resultArea');
        const resultBox = document.getElementById('resultBox');
        const resultCategory = document.getElementById('resultCategory');
        const resultRationale = document.getElementById('resultRationale');
        const resultDisclaimer = document.getElementById('resultDisclaimer');
        const exportPdfButton = document.getElementById('exportPdfButton');
        const pdfContentDiv = document.getElementById('pdfContent');
        const radarChartCanvas = document.getElementById('myRadarChart'); // Get canvas for Chart.js
        let myRadarChart = null; // To store the Chart.js instance


        // Task Identification Form Elements
        const stakeholderCheckboxes = taskIdentificationForm.querySelectorAll('input[name="stakeholder"]');
        const otherStakeholderCheck = document.getElementById('stakeholderOtherCheck');
        const otherStakeholderInput = document.getElementById('otherStakeholderInput');

        // Evaluation Form Elements (prompts are on the Value page)
        const stakeholderPromptsDiv = document.getElementById('stakeholderPrompts');
        const notesValueLabel = document.getElementById('notesValueLabel');

        // Navigation Buttons (select all navigate buttons)
        const navigateButtons = document.querySelectorAll('.navigate-button');

        // Store results globally for PDF export
        let currentResultData = null;
        // Store calculated dimension scores
        let dimensionScores = { nature: null, risk: null, ethics: null, value: null, human: null, feasibility: null };
        // Store dimension descriptions
        const dimensionDescriptions = {
             nature: "The inherent characteristics of the task itself, such as how repetitive, data-driven, or creative it is. This helps determine its baseline suitability for automation.",
             risk: "Potential negative consequences of using AI for this task, including data breaches, bias, safety issues, and damage to integrity or reputation. Higher scores indicate greater risk.",
             ethics: "Alignment with ethical principles like fairness, transparency, accountability, and respect for human autonomy. Higher scores indicate greater ethical concern.",
             value: "The potential benefits and positive effects of using AI on key groups (students, staff, institution). Higher scores indicate greater potential value.",
             human: "The degree to which inherently human skills like empathy, nuanced judgment, mentorship, and complex communication are essential for the task's success. Higher scores indicate greater need for human involvement.",
             feasibility: "The practical and logistical aspects of implementing AI for this task, including technology readiness, data availability, cost, required skills, and policy alignment. Higher scores indicate greater feasibility."
        };

        // --- Navigation Logic ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active')); // Hide all pages
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.add('active'); // Show the target page
                 // Update progress indicator if it exists on the page
                 const progressIndicator = pageToShow.querySelector('.progress-indicator'); // Use class selector
                 if (progressIndicator) {
                     // Update text dynamically if needed, or ensure it's correct in HTML
                     const pageIndex = pageToShow.dataset.pageIndex;
                     if (pageIndex) {
                        progressIndicator.textContent = `Step ${pageIndex} of 9: ${progressIndicator.textContent.split(': ')[1]}`; // Update step number
                     }
                 }
                 // If navigating away from results, destroy the chart
                 if (myRadarChart && pageId !== 'resultsPage') {
                     myRadarChart.destroy();
                     myRadarChart = null; // Clear instance
                 }

            } else {
                console.error("Target page not found:", pageId);
                landingPage.classList.add('active'); // Fallback to landing page
            }
            window.scrollTo(0, 0); // Scroll to top
        }

        navigateButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetPageId = button.dataset.targetPage;
                const currentPage = button.closest('.page');

                // Validation before proceeding from Task Identification
                if (currentPage.id === 'taskIdentificationPage' && targetPageId === 'evaluationPage_Nature') {
                    if (!document.getElementById('taskName').value) {
                        alert('Please enter a Task Name before proceeding.');
                        document.getElementById('taskName').focus();
                        return; // Stop navigation
                    }
                    // Update prompts when moving TO first eval page, but only if not navigating back
                    if (!button.classList.contains('back-button')) {
                        updateStakeholderPrompts();
                    }
                }

                // Validation before proceeding from a dimension page (only on 'Next' clicks)
                if (currentPage.hasAttribute('data-page-index') && !button.classList.contains('back-button')) {
                    const dimensionFieldset = currentPage.querySelector('fieldset[data-dimension]');
                    if (dimensionFieldset) {
                        const dimension = dimensionFieldset.dataset.dimension;
                        // Check if all questions in this dimension are answered
                        const radios = dimensionFieldset.querySelectorAll('input[type="radio"]');
                        // Get unique names (for each question)
                        const names = [...new Set(Array.from(radios).map(r => r.name))];
                        // Check if there is a checked radio for each unique name
                        const allAnswered = names.every(name => dimensionFieldset.querySelector(`input[name="${name}"]:checked`));

                        if (!allAnswered) {
                           const dimensionNumber = currentPage.dataset.pageIndex - 1; // Get dimension number (2-7 -> 1-6)
                           alert(`Please answer all questions for Dimension ${dimensionNumber} before proceeding.`);
                           const firstUnansweredRadio = dimensionFieldset.querySelector('input[type="radio"]:not(:checked)'); // Find first unanswered
                           if(firstUnansweredRadio) {
                               firstUnansweredRadio.focus();
                               firstUnansweredRadio.closest('.question-item')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                           }
                           return; // Stop navigation
                        }
                    }
                }

                showPage(targetPageId);
            });
        });


        // --- Helper Functions ---
        function getRadioValue(name) {
             const radio = document.querySelector(`.page input[name="${name}"]:checked`);
            return radio ? parseInt(radio.value) : null;
        }
        function getRadioLabel(name) {
             const radio = document.querySelector(`.page input[name="${name}"]:checked`);
             return radio ? radio.closest('label').textContent.trim() : 'N/A';
        }
        function getDimensionQuestionData(dimensionName) {
            const questions = {};
            const dimensionPageId = `evaluationPage_${dimensionName.charAt(0).toUpperCase() + dimensionName.slice(1)}`;
            const dimensionPage = document.getElementById(dimensionPageId);
            if (!dimensionPage) return questions;

            const inputs = dimensionPage.querySelectorAll(`fieldset[data-dimension="${dimensionName}"] input[type="radio"]`);
            const uniqueNames = [...new Set(Array.from(inputs).map(input => input.name))];
            uniqueNames.forEach(name => {
                const value = getRadioValue(name);
                const label = getRadioLabel(name);
                const questionKey = name.split('_').slice(1).join('_');
                 const descElement = dimensionPage.querySelector(`input[name="${name}"]`)?.closest('.question-item')?.querySelector('.question-description');
                 const description = descElement ? descElement.textContent.trim() : '';
                questions[questionKey] = { value: value, label: label, description: description };
            });
            return questions;
        }
         function getNotesForDimension(dimensionName) {
             const notesTextArea = document.getElementById(`notes${dimensionName.charAt(0).toUpperCase() + dimensionName.slice(1)}`);
             return notesTextArea ? notesTextArea.value.trim() : '';
         }

        function getSelectedStakeholders() {
            const selected = [];
            taskIdentificationForm.querySelectorAll('input[name="stakeholder"]:checked').forEach(checkbox => {
                if (checkbox.value === 'Other') {
                    const otherText = otherStakeholderInput.value.trim();
                    selected.push(otherText ? `Other (${otherText})` : 'Other (Not specified)');
                } else {
                    selected.push(checkbox.value);
                }
            });
            return selected;
        }

        // --- Stakeholder Prompt Logic ---
        function updateStakeholderPrompts() {
             const selected = getSelectedStakeholders();
             let promptsHTML = '';
             let baseNotesLabel = "Key Impacts (Positive/Negative) & Stakeholder Notes";
             let specificPrompts = [];
             if (selected.length > 0) {
                 promptsHTML = '<p class="font-medium mb-2">Consider the specific impact on:</p><ul>';
                 selected.forEach(stakeholder => {
                     let prompt = '';
                     // Extract base stakeholder name before potential "(...)"
                     const baseStakeholder = stakeholder.split(' (')[0];
                     switch(baseStakeholder) {
                         case 'Students': prompt = 'How might this affect student learning outcomes, engagement, accessibility, or skill development?'; break;
                         case 'Faculty': prompt = 'How might this change faculty workload, teaching methods, research capacity, or job satisfaction?'; break;
                         case 'Admin Staff': prompt = 'How might this impact administrative efficiency, processes, required skills, or staffing levels?'; break;
                         case 'IT Staff': prompt = 'What are the implications for IT infrastructure, support, security, and data management?'; break;
                         case 'Researchers': prompt = 'How might this affect research methodologies, data analysis capabilities, or collaboration?'; break;
                         case 'Other': prompt = `Consider the specific impacts on the 'Other' group: ${otherStakeholderInput.value.trim() || '(Not specified)'}.`; break;
                     }
                     if (prompt) {
                         promptsHTML += `<li><strong>${baseStakeholder}:</strong> ${prompt}</li>`;
                         specificPrompts.push(baseStakeholder);
                     }
                 });
                 promptsHTML += '</ul>';
                 if (stakeholderPromptsDiv) {
                    stakeholderPromptsDiv.innerHTML = promptsHTML;
                    stakeholderPromptsDiv.classList.remove('hidden');
                 }
                 if (notesValueLabel) {
                    notesValueLabel.textContent = `${baseNotesLabel} (Focusing on: ${specificPrompts.join(', ')})`;
                 }
             } else {
                 if (stakeholderPromptsDiv) {
                    stakeholderPromptsDiv.classList.add('hidden');
                    stakeholderPromptsDiv.innerHTML = '';
                 }
                 if (notesValueLabel) {
                    notesValueLabel.textContent = baseNotesLabel;
                 }
             }
        }

        // --- Dimension Score Calculation Functions ---
        function calculateNatureScore() { const scores = [getRadioValue('nature_repetitiveness'), getRadioValue('nature_cognitive'), getRadioValue('nature_data'), getRadioValue('nature_ambiguity')]; if (scores.some(s => s === null)) return null; const avg = scores.reduce((a, b) => a + b, 0) / scores.length; return parseFloat(avg.toFixed(2)); }
        function calculateRiskScore() { const scores = [getRadioValue('risk_privacy'), getRadioValue('risk_bias'), getRadioValue('risk_safety'), getRadioValue('risk_operational')]; if (scores.some(s => s === null)) return null; return Math.max(...scores); }
        function calculateEthicsScore() { const scores = [getRadioValue('ethics_fairness'), getRadioValue('ethics_transparency'), getRadioValue('ethics_accountability'), getRadioValue('ethics_dignity')]; if (scores.some(s => s === null)) return null; return Math.max(...scores); }
        function calculateValueScore() { const scores = [getRadioValue('value_student'), getRadioValue('value_staff'), getRadioValue('value_institution'), getRadioValue('value_alignment')]; if (scores.some(s => s === null)) return null; const avg = scores.reduce((a, b) => a + b, 0) / scores.length; return parseFloat(avg.toFixed(2)); }
        function calculateHumanScore() { const scores = [getRadioValue('human_empathy'), getRadioValue('human_mentorship'), getRadioValue('human_judgment'), getRadioValue('human_communication')]; if (scores.some(s => s === null)) return null; return Math.max(...scores); } // Note: Human scale is 1-4, but we'll plot on a 1-5 scale for consistency
        function calculateFeasibilityScore() { const scores = [getRadioValue('feasibility_tech'), getRadioValue('feasibility_data'), getRadioValue('feasibility_cost'), getRadioValue('feasibility_integration')]; if (scores.some(s => s === null)) return null; const avg = scores.reduce((a, b) => a + b, 0) / scores.length; return parseFloat(avg.toFixed(2)); }

        // --- Update Dimension Score Display ---
        function updateScoreDisplay(dimensionName, score) {
            const scoreElement = document.querySelector(`#score_${dimensionName}`);
            if (scoreElement) {
                scoreElement.textContent = score !== null ? score : 'N/A';
            }
        }

        // --- Render Radar Chart ---
        function renderRadarChart(scores, canvasElement) {
            if (!canvasElement) return; // Safety check

            // Destroy existing chart instance on this canvas if it exists
            const existingChart = Chart.getChart(canvasElement);
            if (existingChart) {
                existingChart.destroy();
            }

            const ctx = canvasElement.getContext('2d');

             // Map scores to array order
             const dataPoints = [
                 scores.nature,
                 scores.risk,
                 scores.ethics,
                 scores.value,
                 scores.human,
                 scores.feasibility
             ];

            myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Nature', 'Risk', 'Ethics', 'Value', 'Human', 'Feasibility'], // Dimension names
                    datasets: [{
                        label: 'Evaluation Score',
                        data: dataPoints,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)', // Blue with transparency
                        borderColor: 'rgba(59, 130, 246, 1)', // Solid blue border
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true, // Set to true to allow aspect ratio control via parent container
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            gridLines: { display: true }, // Corrected from gridLines
                            pointLabels: {
                                display: true,
                                font: { size: 10 } // Adjust label font size
                            },
                            suggestedMin: 1, // Minimum scale value
                            suggestedMax: 5, // Maximum scale value
                            ticks: {
                                beginAtZero: true, // Starts drawing from the center (value 0)
                                stepSize: 1,
                                showLabelBackdrop: false, // Hide the backdrop
                                z: 1 // Ensure ticks are above grid lines
                            },
                            grid: { // Corrected from gridLines
                                color: 'rgba(200, 200, 200, 0.5)' // Lighter grid lines
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { font: { size: 12 } }
                        },
                        tooltip: { enabled: true }
                    },
                    elements: {
                        line: { tension: 0 } // Straight lines between points
                    }
                }
            });
             // Store the chart instance
             if (canvasElement.id === 'myRadarChart') {
                 myRadarChart = Chart.getChart('myRadarChart');
             }

        }


        // --- Event Listeners ---
        document.body.addEventListener('change', (event) => {
            // Update scores on radio change
            if (event.target.type === 'radio' && event.target.closest('fieldset[data-dimension]')) {
                const fieldset = event.target.closest('fieldset[data-dimension]');
                const dimensionName = fieldset.dataset.dimension;
                let score = null;
                const functionName = `calculate${dimensionName.charAt(0).toUpperCase() + dimensionName.slice(1)}Score`;
                if (typeof window[functionName] === 'function') { score = window[functionName](); }
                dimensionScores[dimensionName] = score;
                updateScoreDisplay(dimensionName, score);
            }

            // Handle 'Other Stakeholder' checkbox visibility
            if (event.target === otherStakeholderCheck) {
                 otherStakeholderInput.classList.toggle('hidden', !event.target.checked);
                 if (!event.target.checked) { otherStakeholderInput.value = ''; }
                 // Check if currently on the Value page before updating prompts
                 if (document.getElementById('evaluationPage_Value').classList.contains('active')) { updateStakeholderPrompts(); }
            }
            // Update prompts if a stakeholder checkbox changes (only if currently on Value page)
             if (event.target.name === 'stakeholder' && document.getElementById('evaluationPage_Value').classList.contains('active')) { updateStakeholderPrompts(); }
        });

        // Update prompts if 'Other' text changes (only if currently on Value page and 'Other' checked)
        otherStakeholderInput.addEventListener('input', () => {
             if (otherStakeholderCheck.checked && document.getElementById('evaluationPage_Value').classList.contains('active')) { updateStakeholderPrompts(); }
        });


        // --- Evaluation Form Submission Handler (on last dimension page) ---
        evaluationForm.addEventListener('submit', function(event) {
            event.preventDefault();

            // Recalculate all scores
            Object.keys(dimensionScores).forEach(dim => {
                 const functionName = `calculate${dim.charAt(0).toUpperCase() + dim.slice(1)}Score`;
                 if (typeof window[functionName] === 'function') { dimensionScores[dim] = window[functionName](); }
            });

            // Validation
            const allScoresCalculated = Object.values(dimensionScores).every(score => score !== null);
            if (!allScoresCalculated) {
                 alert('It seems some questions might be unanswered. Please go back and ensure all questions in each dimension are answered.');
                 return; // Stop processing
            }

            // --- Heuristic Logic ---
             // Note: Thresholds are based on the 1-5 scale, except Human (1-4)
            const HIGH_RISK_THRESHOLD = 4; // Max score 5
            const MEDIUM_RISK_THRESHOLD = 2.5; // Max score 5
            const HIGH_ETHICS_THRESHOLD = 4; // Max score 5
            const MEDIUM_ETHICS_THRESHOLD = 2.5; // Max score 5
            const ESSENTIAL_HUMAN_THRESHOLD = 3.5; // Max score 4 -> 3.5 is high end
            const IMPORTANT_HUMAN_THRESHOLD = 2.5; // Max score 4 -> 2.5 is mid-range
            const HIGH_FEASIBILITY_THRESHOLD = 4; // Avg score 1-5
            const LOW_FEASIBILITY_THRESHOLD = 2; // Avg score 1-5
            const MEDIUM_VALUE_THRESHOLD = 2.5; // Avg score 1-5
            const LOW_AUTOMATABILITY_THRESHOLD = 2.5; // Avg score 1-5 (Nature score inverted logic)

            let suggestedCategory = "Undetermined";
            let rationale = "";
            let categoryClass = "result-default";

            // Logic refinement:
            // 1. High Risk/Ethics OR Essential Human -> Human-Led
            // 2. Moderate Risk/Ethics OR Important Human -> AI-Assisted (Human Control)
            // 3. Otherwise (Low Risk/Ethics, Minimal/Beneficial Human):
            //    a. High Feasibility & Good Value & Suitable Nature & Minimal/Beneficial Human -> Full Automation
            //    b. High Feasibility & Good Value & Suitable Nature & Important Human -> High Automation Potential (Human Supervising)
            //    c. High Feasibility & Good Value BUT Unsuitable Nature -> AI-Assisted (Human Control)
            //    d. Any other case (e.g., Low Feasibility, Low Value) -> AI-Assisted (Human Control)

            if (dimensionScores.risk >= HIGH_RISK_THRESHOLD || dimensionScores.ethics >= HIGH_ETHICS_THRESHOLD || dimensionScores.human >= ESSENTIAL_HUMAN_THRESHOLD) {
                suggestedCategory = "Human-Led (No/Minimal AI)";
                rationale = `High risk (Score ${dimensionScores.risk}), significant ethical concerns (Score ${dimensionScores.ethics}), or essential human element requirement (Score ${dimensionScores.human}) strongly suggest minimal to no AI involvement.`;
                categoryClass = "result-human-led";
            } else if (dimensionScores.risk >= MEDIUM_RISK_THRESHOLD || dimensionScores.ethics >= MEDIUM_ETHICS_THRESHOLD || dimensionScores.human >= IMPORTANT_HUMAN_THRESHOLD) {
                suggestedCategory = "AI-Assisted (Human in Control)";
                rationale = `Moderate risk (Score ${dimensionScores.risk}), moderate ethical concerns (Score ${dimensionScores.ethics}), or important human element requirement (Score ${dimensionScores.human}) indicate AI could assist, but requires significant human oversight and control.`;
                categoryClass = "result-ai-assisted";
                 if (dimensionScores.feasibility <= LOW_FEASIBILITY_THRESHOLD) { rationale += " Low feasibility (Score ${dimensionScores.feasibility}) further limits the scope for automation."; }
            }
            else if (dimensionScores.feasibility >= HIGH_FEASIBILITY_THRESHOLD && dimensionScores.value >= MEDIUM_VALUE_THRESHOLD) {
                // Lower Nature score implies less routine/more complex, less automatable for full automation
                 if (dimensionScores.nature > LOW_AUTOMATABILITY_THRESHOLD) { // Nature score > 2.5 means it's leaning towards repetitive/rule-following/structured data/deterministic (more automatable)
                      if (dimensionScores.human < IMPORTANT_HUMAN_THRESHOLD) { // Human score < 2.5 means minimal/beneficial human element
                         suggestedCategory = "Full Automation (Minimal Oversight Post-Setup)";
                         rationale = `Low risk/ethics/human need, combined with high feasibility (Score ${dimensionScores.feasibility}), good value (Score ${dimensionScores.value}) and suitable task nature (Score ${dimensionScores.nature} > ${LOW_AUTOMATABILITY_THRESHOLD}), points towards potential full automation.`;
                         categoryClass = "result-full-automation";
                      } else { // Human score >= 2.5 means important human element
                         suggestedCategory = "High Automation Potential (Human Supervising)";
                         rationale = `Low risk/ethics, high feasibility (Score ${dimensionScores.feasibility}), good value (Score ${dimensionScores.value}) and suitable task nature (Score ${dimensionScores.nature} > ${LOW_AUTOMATABILITY_THRESHOLD}) suggest significant automation potential, but human supervision is needed due to an important human element requirement (Score ${dimensionScores.human}).`;
                         categoryClass = "result-high-automation";
                      }
                  } else { // Nature score <= 2.5 means it's leaning towards variable/judgmental/qualitative/ambiguous (less automatable)
                       suggestedCategory = "AI-Assisted (Human in Control)";
                       rationale = `Although risk/ethics/human factors are low and feasibility/value are high, the task nature (Score ${dimensionScores.nature} <= ${LOW_AUTOMATABILITY_THRESHOLD}) suggests human judgment or adaptation is still valuable, making AI assistance with human control more appropriate than full automation.`;
                       categoryClass = "result-ai-assisted";
                  }
             }
             else {
                  // Fallback/default for cases that don't fit the above clear thresholds
                  // This captures moderate feasibility, lower value, or mixed factors
                  suggestedCategory = "AI-Assisted (Human in Control)";
                  rationale = "Based on the overall assessment across dimensions, considering factors like moderate feasibility, value, and task complexity, AI assistance with human control appears most suitable.";
                  categoryClass = "result-ai-assisted";
             }


             // --- Store results for PDF export ---
             currentResultData = {
                 taskName: document.getElementById('taskName').value,
                 evaluator: document.getElementById('evaluator').value,
                 evalDate: document.getElementById('evalDate').value,
                 stakeholders: getSelectedStakeholders(),
                 dimensions: {
                     nature: { score: dimensionScores.nature, description: dimensionDescriptions.nature, questions: getDimensionQuestionData('nature'), notes: getNotesForDimension('nature') },
                     risk: { score: dimensionScores.risk, description: dimensionDescriptions.risk, questions: getDimensionQuestionData('risk'), notes: getNotesForDimension('risk') },
                     ethics: { score: dimensionScores.ethics, description: dimensionDescriptions.ethics, questions: getDimensionQuestionData('ethics'), notes: getNotesForDimension('ethics') },
                     value: { score: dimensionScores.value, description: dimensionDescriptions.value, questions: getDimensionQuestionData('value'), notes: getNotesForDimension('value') },
                     human: { score: dimensionScores.human, description: dimensionDescriptions.human, questions: getDimensionQuestionData('human'), notes: getNotesForDimension('human') },
                     feasibility: { score: dimensionScores.feasibility, description: dimensionDescriptions.feasibility, questions: getDimensionQuestionData('feasibility'), notes: getNotesForDimension('feasibility') }
                 },
                 suggestedCategory: suggestedCategory, rationale: rationale,
                 disclaimer: `Disclaimer: This is a preliminary suggestion based on the calculated scores. A thorough discussion involving relevant stakeholders, considering the detailed notes and context, is crucial for the final decision.`
             };

            // --- Display Results on Results Page ---
            resultCategory.textContent = `Suggested Category: ${suggestedCategory}`;
            resultRationale.textContent = `Rationale: ${rationale}`;
            resultDisclaimer.textContent = currentResultData.disclaimer;
            resultBox.className = ''; // Reset classes
            resultBox.classList.add('resultBox', 'max-w-3xl', 'mx-auto', categoryClass); // Add base and category class

            // Render the radar chart
            renderRadarChart(dimensionScores, radarChartCanvas);

            // Navigate to the results page
            showPage('resultsPage');
        });

        // --- PDF Export Handler ---
        exportPdfButton.addEventListener('click', async function() { // Use async as html2pdf returns a promise
            if (!currentResultData) { alert("Cannot export - results not calculated yet."); return; }

            // Clear previous PDF content and setup the rendering area
            pdfContentDiv.innerHTML = '';
            pdfContentDiv.classList.remove('hidden');
            pdfContentDiv.classList.add('pdf-render-area');

            // Build the text/HTML part of the PDF content
            let pdfHTML = `<h1>AI Task Taxonomy Evaluation Report</h1><h2>Task Identification</h2> <p><span class="label">Task Name:</span> ${currentResultData.taskName || 'N/A'}</p> <p><span class="label">Evaluator(s):</span> ${currentResultData.evaluator || 'N/A'}</p> <p><span class="label">Date:</span> ${currentResultData.evalDate || 'N/A'}</p> <p class="stakeholder-list-pdf"><span class="label">Key Stakeholders:</span> ${currentResultData.stakeholders.length > 0 ? currentResultData.stakeholders.join(', ') : 'None selected'}</p>`;

             // Add the chart canvas wrapper
             pdfHTML += `<h2>Dimension Scores Overview</h2><div class="chart-container-pdf"><canvas id="pdfRadarChart"></canvas></div>`;

            // Add Dimension Evaluation details
            pdfHTML += `<h2>Dimension Evaluation Details</h2>`;
            let dimensionIndex = 1;
            const dimensionOrder = ['nature', 'risk', 'ethics', 'value', 'human', 'feasibility']; // Define order for clarity
            for (const key of dimensionOrder) {
                 const data = currentResultData.dimensions[key];
                 const title = key.charAt(0).toUpperCase() + key.slice(1);
                 pdfHTML += `<h3>${dimensionIndex}. ${title}</h3>`;
                 pdfHTML += `<p class="dimension-desc-pdf">${data.description || ''}</p>`;
                 // Sort question keys to maintain order if needed, or use existing order
                 const questionKeys = Object.keys(data.questions);
                 for (const qKey of questionKeys) {
                     const qData = data.questions[qKey];
                     const qText = qKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                     pdfHTML += `<div class="question-block">
                                    <p class="question-text">${qText}:</p>
                                    ${qData.description ? `<p class="question-desc-pdf">${qData.description}</p>` : ''}
                                    <p class="question-answer">${qData.label} (Score: ${qData.value ?? 'N/A'})</p>
                                 </div>`;
                 }
                 pdfHTML += `<p class="notes"><span class="label">Notes:</span> ${data.notes || 'None'}</p>`;
                 pdfHTML += `<p class="dimension-score-pdf">Overall Dimension Score: ${data.score ?? 'N/A'}</p>`;
                 dimensionIndex++;
            }

            // Add the final result section
            pdfHTML += `<div class="result-section"><h2>Evaluation Result</h2><p class="result-category"><span class="label">Suggested Category:</span> ${currentResultData.suggestedCategory}</p><p class="result-rationale"><span class="label">Rationale:</span> ${currentResultData.rationale}</p><p class="result-disclaimer">${currentResultData.disclaimer}</p></div>`;

            // Set the HTML content of the hidden PDF rendering area
            pdfContentDiv.innerHTML = pdfHTML;

            // Get the newly created canvas inside the pdfContent div
            const pdfRadarCanvas = pdfContentDiv.querySelector('#pdfRadarChart');

             // Render the chart onto the PDF canvas
             // Need scores array in correct order
             const scoresArray = [
                 currentResultData.dimensions.nature.score,
                 currentResultData.dimensions.risk.score,
                 currentResultData.dimensions.ethics.score,
                 currentResultData.dimensions.value.score,
                 currentResultData.dimensions.human.score,
                 currentResultData.dimensions.feasibility.score
             ];
             renderRadarChart({
                 nature: scoresArray[0],
                 risk: scoresArray[1],
                 ethics: scoresArray[2],
                 value: scoresArray[3],
                 human: scoresArray[4],
                 feasibility: scoresArray[5]
             }, pdfRadarCanvas);


            const filename = `AI_Taxonomy_Report_${(currentResultData.taskName || 'task').replace(/[^a-z0-9]/gi, '_').toLowerCase()}.pdf`;
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5], filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, logging: false },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            console.log("Generating PDF...");
            try {
                 // Generate the PDF from the pdfContentDiv
                 await new Promise(r => setTimeout(r, 100));
                 await html2pdf().from(pdfContentDiv).set(opt).save();
                 console.log("PDF Generated Successfully.");
            } catch (err) {
                 console.error("Error generating PDF:", err);
                 alert("An error occurred generating PDF. Check console for details.");
            } finally {
                 // Clean up: hide the rendering area and clear its content
                 pdfContentDiv.classList.add('hidden');
                 pdfContentDiv.classList.remove('pdf-render-area');
                 pdfContentDiv.innerHTML = '';
            }
        });

        // --- Initial Setup ---
        document.getElementById('evalDate').valueAsDate = new Date();
        updateStakeholderPrompts(); // Initial call to set label text

        // Show Landing Page by default
        showPage('landingPage'); // Use page ID directly

    </script>

</body>
</html>